<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Link da Bio — Prateleiras</title>
  <style>
    :root{
      --bg:#0b0b0d;
      --card:#0f1113;
      --muted:#9aa0a6;
      --accent:#b88700; /* dourado sutil */
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg),#050507);color:#e9edf0;min-height:100vh}

    /* Topo / menu */
    header{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(0,0,0,0.45),transparent);backdrop-filter:blur(6px);padding:12px 18px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:52px;height:52px;border-radius:12px;overflow:hidden;background:linear-gradient(135deg,#111,#1a1a1a);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.04)}
    .logo img{width:100%;height:100%;object-fit:cover}
    nav{margin-left:auto;display:flex;gap:8px}
    nav button{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
    nav button.active{border-color:var(--accent);color:var(--accent);font-weight:600}

    main{max-width:980px;margin:26px auto;padding:0 18px}
    .hero{display:flex;gap:18px;align-items:center;padding:18px;background:linear-gradient(180deg,var(--card),transparent);border-radius:14px;border:1px solid rgba(255,255,255,0.03)}
    .hero .info{flex:1}
    .hero h1{margin:0;font-size:1.6rem}
    .hero p{margin:8px 0 0;color:var(--muted)}

    .controls{display:flex;gap:8px;margin-top:12px}
    .btn{background:linear-gradient(90deg,var(--accent),#ffd97a);color:#111;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:600}

    /* Prateleiras */
    .shelves{margin-top:20px;display:flex;flex-direction:column;gap:18px}
    .shelf{background:var(--glass);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
    .shelf-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .shelf-title{font-weight:700}
    .shelf-actions{display:flex;gap:8px}

    .links{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .link-card{width:calc(33.333% - 6.6px);min-width:160px;background:var(--card);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center;cursor:grab}
    .link-card img{width:44px;height:44px;border-radius:8px;object-fit:cover;flex-shrink:0}
    .link-meta{flex:1}
    .link-meta .title{font-weight:700}
    .link-meta .url{font-size:0.85rem;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .link-card .actions{margin-left:8px;display:flex;flex-direction:column;gap:6px}
    .small{padding:6px 8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;font-size:0.85rem}

    /* Feedbacks */
    .feedbacks{margin-top:28px;background:linear-gradient(180deg,var(--glass-2),transparent);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .uploader{display:flex;gap:12px;align-items:center}
    .uploader input[type=file]{display:none}
    .uploader label{padding:10px 14px;border-radius:10px;border:1px dashed rgba(255,255,255,0.05);cursor:pointer;color:var(--muted)}
    .preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:12px}
    .preview-grid img{width:100%;height:100px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.04)}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:80}
    .modal{background:linear-gradient(180deg,#0b0e10,#0b0b0b);padding:18px;border-radius:12px;max-width:520px;width:100%;border:1px solid rgba(255,255,255,0.04)}
    .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}
    input[type=text],input[type=url],select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

    footer{margin:40px 0 80px;text-align:center;color:var(--muted)}

    @media (max-width:880px){
      .link-card{width:calc(50% - 6.6px)}
      .hero{flex-direction:column}
    }
    @media (max-width:520px){
      .link-card{width:100%}
      header{padding:10px}
      .logo{width:44px;height:44px}
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='%230a0a0a'/><text x='50%' y='55%' fill='%23b88700' font-size='72' font-family='Arial' text-anchor='middle' dominant-baseline='middle'>T</text></svg>" alt="logo"></div>
    <div>
      <div style="font-weight:800">Thurzin Trader</div>
      <div style="font-size:0.85rem;color:var(--muted)">Organize seus links por prateleiras</div>
    </div>
  </div>

  <nav>
    <button class="active" data-target="shelves">Prateleiras</button>
    <button data-target="feedbacks">Feedbacks</button>
    <button data-target="config">Config</button>
  </nav>
</header>

<main>
  <section class="hero">
    <div class="info">
      <h1>Link da Bio com prateleiras</h1>
      <p>Crie prateleiras (categorias), adicione botões (links) com imagem e rearranje. Tudo armazenado no navegador.</p>
      <div class="controls">
        <button class="btn" id="addShelf">+ Adicionar Prateleira</button>
        <button class="btn secondary" id="openAddLink">+ Adicionar Botão</button>
        <button class="btn secondary" id="resetStorage">Limpar dados</button>
      </div>
    </div>
    <div style="width:160px;text-align:center">
      <div style="background:linear-gradient(180deg,rgba(184,135,0,0.12),transparent);padding:10px;border-radius:12px;border:1px solid rgba(184,135,0,0.08)">Preview
        <div style="margin-top:10px;background:#0b0b0b;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)">Seu link da bio</div>
      </div>
    </div>
  </section>

  <section id="shelvesSection" class="shelves">
    <!-- prateleiras são injetadas aqui -->
  </section>

  <section id="feedbacksSection" class="feedbacks" style="display:none">
    <h3>Enviar feedbacks / imagens</h3>
    <div class="uploader">
      <label for="fbUpload">+ Selecionar imagens</label>
      <input id="fbUpload" type="file" accept="image/*" multiple />
    </div>
    <div class="preview-grid" id="feedbackGrid"></div>
  </section>

  <section id="configSection" style="display:none;margin-top:18px">
    <div style="background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
      <h3>Configurações</h3>
      <p style="color:var(--muted)">As informações são salvas localmente no seu navegador. Para usar em outro dispositivo, exporte as prateleiras (JSON).</p>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="exportData">Exportar JSON</button>
        <button class="btn secondary" id="importDataBtn">Importar JSON</button>
        <input type="file" id="importFile" accept="application/json" style="display:none">
      </div>
    </div>
  </section>

  <footer>Feito com ❤️ — personalize como quiser</footer>
</main>

<!-- Modal adicionar link -->
<div class="modal-backdrop" id="modalBack">
  <div class="modal">
    <h3>Adicionar / Editar Botão</h3>
    <div class="form-row">
      <label>Título</label>
      <input type="text" id="linkTitle" placeholder="Ex: Acessar Curso" />
    </div>
    <div class="form-row">
      <label>URL</label>
      <input type="url" id="linkUrl" placeholder="https://" />
    </div>
    <div class="form-row">
      <label>Escolher imagem (opcional)</label>
      <input type="file" id="linkImg" accept="image/*" />
    </div>
    <div class="form-row">
      <label>Colocar na prateleira</label>
      <select id="shelfSelect"></select>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button class="btn secondary" id="closeModal">Cancelar</button>
      <button class="btn" id="saveLink">Salvar</button>
    </div>
  </div>
</div>

<script>
  // estado simples em localStorage
  const LS_KEY = 'linkbio_shelves_v1'
  let state = { shelves: [] }
  const shelvesSection = document.getElementById('shelvesSection')
  const modalBack = document.getElementById('modalBack')

  function uid(){return Math.random().toString(36).slice(2,9)}

  function load(){
    const raw = localStorage.getItem(LS_KEY)
    if(raw) state = JSON.parse(raw)
    else {
      // inicializa com uma prateleira padrão
      state = { shelves: [{id:uid(),title:'Principais',links:[]} ] }
      save()
    }
    render()
  }
  function save(){ localStorage.setItem(LS_KEY,JSON.stringify(state)) }

  function render(){
    shelvesSection.innerHTML = ''
    state.shelves.forEach(s => shelvesSection.appendChild(renderShelf(s)))
    updateShelfSelect()
  }

  function renderShelf(shelf){
    const el = document.createElement('div'); el.className='shelf'; el.dataset.id=shelf.id
    el.innerHTML = `
      <div class="shelf-head">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="shelf-title" contenteditable="true" data-id="${shelf.id}">${escapeHtml(shelf.title)}</div>
          <div style="color:var(--muted);font-size:0.9rem">${shelf.links.length} item(s)</div>
        </div>
        <div class="shelf-actions">
          <button class="small" data-action="addLink" data-id="${shelf.id}">+ Botão</button>
          <button class="small" data-action="delShelf" data-id="${shelf.id}">Deletar</button>
        </div>
      </div>
      <div class="links" data-id="links-${shelf.id}"></div>
    `
    // eventos contenteditable
    el.querySelector('.shelf-title').addEventListener('input', e=>{
      const id = e.target.dataset.id
      const s = state.shelves.find(x=>x.id===id); if(s){ s.title = e.target.innerText; save(); }
    })

    // actions
    el.querySelectorAll('[data-action="addLink"]').forEach(btn=>btn.addEventListener('click',()=>openModalForShelf(shelf.id)))
    el.querySelectorAll('[data-action="delShelf"]').forEach(btn=>btn.addEventListener('click',()=>{
      if(confirm('Deletar prateleira e todos os links?')){
        state.shelves = state.shelves.filter(x=>x.id!==shelf.id); save(); render();
      }
    }))

    const linksCont = el.querySelector('.links')
    shelf.links.forEach(link=>linksCont.appendChild(renderLink(link,shelf.id)))

    // setup dragover to allow drop
    linksCont.addEventListener('dragover', e=>e.preventDefault())
    linksCont.addEventListener('drop', e=>{
      const linkId = e.dataTransfer.getData('text/plain')
      const fromShelfId = e.dataTransfer.getData('fromShelf')
      if(!linkId) return
      moveLinkBetweenShelves(linkId, fromShelfId, shelf.id)
    })

    return el
  }

  function renderLink(link,shelfId){
    const card = document.createElement('div'); card.className='link-card'; card.draggable=true; card.dataset.id=link.id
    card.innerHTML = `
      <img src="${link.img||placeholderData(link.title)}" alt="">
      <div class="link-meta">
        <div class="title">${escapeHtml(link.title)}</div>
        <div class="url">${escapeHtml(link.url)}</div>
      </div>
      <div class="actions">
        <button class="small" data-action="edit" data-id="${link.id}" data-shelf="${shelfId}">Editar</button>
        <button class="small" data-action="visit" data-id="${link.id}" data-url="${escapeAttr(link.url)}">Abrir</button>
      </div>
    `
    // drag events
    card.addEventListener('dragstart', e=>{
      e.dataTransfer.setData('text/plain', link.id)
      e.dataTransfer.setData('fromShelf', shelfId)
    })

    card.querySelector('[data-action="edit"]').addEventListener('click', e=>{
      openModalForEdit(link.id, shelfId)
    })
    card.querySelector('[data-action="visit"]').addEventListener('click', e=>{
      const url = e.target.dataset.url
      window.open(url,'_blank')
    })

    return card
  }

  function placeholderData(text){
    return 'data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><rect width=\"100%\" height=\"100%\" fill=\"%230b0b0b\"/><text x=\"50%\" y=\"55%\" fill=\"%23b88700\" font-family=\"Arial\" font-size=14 text-anchor=\"middle\">${escapeHtml(text.slice(0,12))}</text></svg>`)
  }

  function moveLinkBetweenShelves(linkId, fromId, toId){
    if(fromId===toId) return
    const from = state.shelves.find(s=>s.id===fromId)
    const to = state.shelves.find(s=>s.id===toId)
    if(!from||!to) return
    const idx = from.links.findIndex(l=>l.id===linkId)
    if(idx===-1) return
    const [link] = from.links.splice(idx,1)
    to.links.push(link)
    save(); render()
  }

  // modal logic
  let editing = null
  function openModalForShelf(shelfId){
    editing = {type:'new', shelfId}
    document.getElementById('linkTitle').value = ''
    document.getElementById('linkUrl').value = ''
    document.getElementById('linkImg').value = ''
    updateShelfSelect()
    modalBack.style.display='flex'
  }
  function openModalForEdit(linkId,shelfId){
    editing = {type:'edit', linkId, shelfId}
    const shelf = state.shelves.find(s=>s.id===shelfId)
    const link = shelf.links.find(l=>l.id===linkId)
    document.getElementById('linkTitle').value = link.title
    document.getElementById('linkUrl').value = link.url
    document.getElementById('linkImg').value = ''
    updateShelfSelect(shelfId)
    modalBack.style.display='flex'
  }
  document.getElementById('closeModal').addEventListener('click', ()=>modalBack.style.display='none')

  document.getElementById('saveLink').addEventListener('click', async ()=>{
    const title = document.getElementById('linkTitle').value.trim() || 'Sem título'
    const url = document.getElementById('linkUrl').value.trim() || '#'
    const imgInput = document.getElementById('linkImg')
    const shelfId = document.getElementById('shelfSelect').value
    let imgData = null
    if(imgInput.files && imgInput.files[0]) imgData = await fileToDataURL(imgInput.files[0])

    if(editing && editing.type==='new'){
      const shelf = state.shelves.find(s=>s.id===shelfId)
      shelf.links.push({id:uid(),title,url,img:imgData})
    }else if(editing && editing.type==='edit'){
      const shelf = state.shelves.find(s=>s.id===shelfId)
      const link = shelf.links.find(l=>l.id===editing.linkId)
      if(link){ link.title=title; link.url=url; if(imgData) link.img=imgData }
    }
    save(); render(); modalBack.style.display='none'
  })

  function updateShelfSelect(pref){
    const sel = document.getElementById('shelfSelect')
    sel.innerHTML = ''
    state.shelves.forEach(s=>{
      const opt = document.createElement('option'); opt.value=s.id; opt.textContent=s.title
      if(pref && s.id===pref) opt.selected=true
      sel.appendChild(opt)
    })
  }

  // add shelf
  document.getElementById('addShelf').addEventListener('click', ()=>{
    const name = prompt('Nome da nova prateleira:','Nova prateleira')
    if(!name) return
    state.shelves.push({id:uid(),title:name,links:[]}); save(); render()
  })

  // open add link
  document.getElementById('openAddLink').addEventListener('click', ()=>openModalForShelf(state.shelves[0]?.id))

  // reset
  document.getElementById('resetStorage').addEventListener('click', ()=>{
    if(confirm('Limpar todos os dados salvos localmente?')){ localStorage.removeItem(LS_KEY); load() }
  })

  // feedbacks upload
  document.getElementById('fbUpload').addEventListener('change', async e=>{
    const files = Array.from(e.target.files)
    const grid = document.getElementById('feedbackGrid')
    for(const f of files){
      const url = await fileToDataURL(f)
      const img = document.createElement('img'); img.src = url
      grid.prepend(img)
    }
  })

  // export/import
  document.getElementById('exportData').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)],{type:'application/json'})
    const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='prateleiras.json'; a.click()
  })
  document.getElementById('importDataBtn').addEventListener('click', ()=>document.getElementById('importFile').click())
  document.getElementById('importFile').addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ state = JSON.parse(r.result); save(); render(); alert('Importado!') }catch(err){alert('Arquivo inválido')} } ; r.readAsText(f)
  })

  // nav
  document.querySelectorAll('nav button').forEach(btn=>btn.addEventListener('click', e=>{
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'))
    e.target.classList.add('active')
    const t = e.target.dataset.target
    document.getElementById('shelvesSection').style.display = t==='shelves'? 'block':'none'
    document.getElementById('feedbacksSection').style.display = t==='feedbacks'? 'block':'none'
    document.getElementById('configSection').style.display = t==='config'? 'block':'none'
  }))

  // helpers
  function fileToDataURL(file){ return new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(file) }) }
  function escapeHtml(str){ return String(str).replace(/[&<>\"]+/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]||c)) }
  function escapeAttr(s){ return String(s).replace(/"/g,'\"') }

  // delete individual link via context menu (double click)
  document.addEventListener('dblclick', e=>{
    const card = e.target.closest('.link-card')
    if(!card) return
    if(confirm('Deletar este link?')){
      const id = card.dataset.id
      state.shelves.forEach(s=>s.links = s.links.filter(l=>l.id!==id))
      save(); render()
    }
  })

  // init
  load()
</script>
</body>
</html>
